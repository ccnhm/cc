<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
		<title>新人礼</title>
		<link type="text/css" rel="stylesheet" href="https://apps.jaadee.com/static/home/Tenyear/m/style.css" />
		<script src="https://appres.jaadee.com/apps/js/zepto.min.js"></script>
		<script src="https://appres.jaadee.com/apps/js/layer.js"></script>
		<script src="https://appres.jaadee.com/apps/js/zepto.picLazyLoad.min.js"></script>
		<script src="https://res.jaadee.net/rn/JaadeeAppJsBridge.js?v=1.4"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.js" ></script>
		<style>
			*{margin:0;padding:0;box-sizing: border-box;}
			body{background: #efefef;}
			.coupen{padding: 0.4rem 0;background:#FFFFFF;}
			.coupen .li{position: relative; color: #FFFFFF;margin-bottom: 0.2rem;}
			.coupen .li img{width: 100%;}
			.jtype{font-size: 0.266666rem;position: absolute;left: 1rem;top: 0.1rem;}
			.jname{font-size: 0.56rem;position: absolute;left: 1.2rem;top: 0.8rem;}
			.jsm{font-size: 0.293333rem;position: absolute; left: 1rem; top: 1.6rem;}
			.flag{position: absolute;font-size: 0.346666rem; right: 1rem;top: 0.1rem;}
			.rule{text-align: right; padding: 0 0.3rem 0.3rem 0; font-size: 0.32rem;color: #333333;}
			.lqbox{padding: 0.8rem 0 0.426666rem 0;}
			.lq{width: 92%;margin: auto;background: #e03a2e;line-height: 1.066666rem;text-align: center;color: #FFFFFF;font-size: 0.4rem;border-radius: 0.2rem;}
			.notice{font-size: 0.32rem;color: #6d6d6d;margin: 0.4rem 0;line-height: 0.6rem;}
			.inputbox{padding: 0 0.266666rem;}
			.relative{position: relative;}
			.tel{background: #fff;font-size: 0.373333rem;width: 100%;border: 1px solid #efefef;height: 1.2rem; line-height: 1.2rem;padding: 0 0.6rem;margin-top: 0.48rem;}
			.zz{display: none;width: 100%;height: 100%;position: fixed;background: rgba(0,0,0,0.7);z-index: 2;top: 0;}
			.tip{display: none;overflow: hidden;text-align: center;width: 7.6rem;position: fixed;left: 1.2rem;top: 5rem;border-radius: 0.2rem;background: #FFFFFF;z-index: 3;}
			.tip .title{height: 0.56rem;font-size: 0.426666rem;margin:0.8rem auto;font-weight: bold;margin-bottom: 1.2rem;}
			.tip .errortex{height: 1.386666rem;font-size: 0.32rem;color: #575757;width: 6.4rem;margin: auto;line-height: 0.7rem;margin-bottom: 0.4rem;}
			.extra{background: #e03a2e;line-height: 0.88rem;color: #FFFFFF;font-size: 0.346666rem;}
			.close{position: fixed;right: 1.5rem;width: 0.4rem;margin-top: 0.3rem;}
			.msgbox{width: 90%;margin-left: 5%;padding: 0.5rem 0;}
			.layui-m-layercont{padding: 0;}
			.msgbox .text p b{font-size: .46rem;}
			.msgbox .text p{font-size: 0.32rem;}
			.msgbox .btn a{font-size: 0.42rem;}
			.msgbox .btn{margin-top: 0.5rem;}
			.code_box{background: #FFFFFF;width:90%;height: auto;    padding: 0.3rem 0 0.6rem 0;border-radius: 0.2rem;}
			.code_box .line1{width: 90%;display: block;position: initial;margin: auto;height: 1.2rem;    margin-bottom: 0.4rem;}
			.code_box input{width: 100%;    line-height: 1.2rem;height: 1.2rem;border-radius: 0.1rem;    font-size: 0.36rem;padding: 0 0.4rem;}
			.code_box .line2{position: relative;width: 90%;margin: auto;height: 1.2rem;display: block;left: 0;top: 0;}
			.get-code{    font-size: 0.36rem;position: absolute;line-height: 0.8rem;background: #E03A2E;color: #FFFFFF;top: 0.2rem;right: 0.2rem;    padding: 0 0.2rem;border-radius: 0.1rem;}
			.title{text-align: center;font-size: 0.42rem;font-weight: bold;padding: 0.8rem 0;}
			.code_box .sure {display: block;width: 90%;line-height: 1rem;position: initial;background: #E03A2E;margin: auto;color: #fff;border-radius: 0.1rem;margin-top: 0.4rem;height: 1rem;font-size: 0.42rem;}
			.layui-m-layer0 .layui-m-layerchild{max-width: 100%;}
			.close img{width: 80%;}
		</style>
	</head>
	<body>
		<script type="text/javascript" src="js/flexible.debug.js" ></script>
		<div class="zz"></div>
		<div class="tip">
			<img src="img/close.png" class="close" />
			<div class="title">领取成功</div>
			<div class="extra" onclick="AppJump.goBonusLists()">查看券</div>
		</div>
		<div class="coupen">
			<div class="li">
				<img src="img/coupen.png">
				<div class="jtype">翡翠王朝专属邀请券</div>
				<div class="jname">9.5折优惠券</div>
				<div class="jsm">注：全品类、无门槛</div>
				<div class="flag">新人礼</div>
			</div>
			<div class="li">
				<img src="img/coupenno.png" class="jz">
				<div class="jtype">翡翠王朝专属邀请券</div>
				<div class="jname">9折优惠券</div>
				<div class="jsm">注：全品类、无门槛</div>
				<div class="flag">邀请礼</div>
			</div>
			<div class="inputbox">
			<input name="tel" type="text" placeholder="填写邀请码者手机号" class="tel" onkeyup="ck(this.value)" disabled="disabled">
			<div class="notice">
				<p>注</p>
				<p>1、填写邀请码或者手机号可以多领取一份邀请专享礼。</p>
				<p>2、券从领取日算起一年有效，不可与其它任何优惠叠加使用</p>
			</div>
		</div>
		</div>
		
		<div class="lqbox">
			<div class="lq">立即领取</div>
		</div>
		<script>
			
		
			var ds='';
			var lq=false;
		   
		    
		
		</script>
		<script>
			
			$(".close").click(function(){
				$(".zz,.tip").hide();
			})
			 //用户打开页面，判断是否登录
            window.setTimeout(function() {
            	

                if(RNJsBriageObject.userInfo.userId <= 0) {
                    showlogin();
                }
                else{
                    checkMobile()
                }
				
            }, 1000);
           
           
           
            //检测是否绑定手机
            function checkMobile() {
            	closeLayer();
                $.ajax({
                    type: "post",
                    url:"https://share.jaadee.net/h5/Active/recommendUsersInfo",
                    data: {uid:RNJsBriageObject.userInfo.userId},
                    dataType: "json",
                    success: function(data) {
                    	data=JSON.parse(data)
                        if(data.status == 0) {
                        	if(data.info.phone){
                        		//判断是否领取过
                        		checklq()
	                        	
                        	}else{
                        		clickBind()
                        	}
                        } 
                    }
                });
            }
           
          //检测是否领取过优惠券
          function checklq(){
          	$.ajax({
                type: "post",
                url: "https://share.jaadee.net/H5/recommend/check9?token="+RNJsBriageObject.userInfo.userToken,
                data: {
                    
                },
                dataType: "json",
                success: function(data) {
                	data=JSON.parse(data)
                    if(data.status == 0) {
                       $(".tel").removeAttr("disabled").focus()
                       if(lq==true){ //点击领取
                    		lq=false;
                    		lqcoupen()
                    	}
                    }else{
                    	$(".lq").css({"background":"#c2c2c2"});
                    	$(".lq").html("已领取")
                    	
                    	
                    }
                }
            });
          }
            
            //领取优惠券
            function lqcoupen(){
            	$.ajax({
                    type: "post",
                    url: "https://share.jaadee.net/H5/recommend/getRecommendCoupon?token="+RNJsBriageObject.userInfo.userToken,
                    data: {
                        code: $("input[name=tel]").val()
                    },
                    dataType: "json",
                    success: function(data) {
                    	data=JSON.parse(data)
                        if(data.status == 0) {
                            //alert(55);
                            //layer.msg("1111");
                            $(".lq").css({"background":"#c2c2c2"});
        					$(".lq").html("已领取")
                            $(".zz,.tip").show();
                            
                        }else{
                        	//alert(data.msg);
                        	html = '';
                            html += '<div class="msgbox">';
                            html += '<div class="text">';
                            html += '<p><b>'+data.msg+'</b></p>';
                            html += '</div>';
                            html += '<div class="btn">';
                            html += '<a onclick="closelogin();">关闭</a>';
                            html += '</div>';
                            html += '</div>';
                            layer.open({
                                content: html,
                                style: "background:none; width:100%"
                            });
                        }
                    }
                });
            }
            
            
            
            //绑定手机弹出框
            function clickBind() {
                var html = '';
                html += '<div class="code_box">';
                html += '<a onclick="closeLayer()" class="close"><img src="img/close.png"></a>';
                html += '<div class="title">绑定手机号</div><div class="line1">';
                html += '<input id="phone" value="" type="text" placeholder="请输入手机号码领取" />';
                html += '</div>';
                html += '<div class="line2">';
                html += '<input id="code" type="text" />';
                html += '<div class="get-code" datasend="1" onclick="sendCode(this);">获取验证码</div>';
                html += '</div>';
                html += '<div id="bindtelbutton" onclick="bindfun('+RNJsBriageObject.userInfo.userId+')" class="sure">立即绑定</div>';
                html += '</div>';
                layer.open({
                    content: html,
                    style: "background:none; width:100%"
                });
            }
           
            //绑定手机号码
            function bindfun(uid) {
               
                var tel = $("#phone").val();
                var code = $("#code").val();
                if(tel == "") {
                   // alert("电话号码不能为空");
                     $("#phone").focus().val("手机号不能为空！");
                    return false;
                }else if(!$("#phone").val().match(/^((1[0-9]{1})+\d{9})$/)) {
                    $("#phone").focus().val("手机号码格式不正确");
                    return false;
                }else if(code == ""){
                   // alert("验证码不能为空");
                    $("#code").focus().val("验证码不能为空");
                    return false;
                }
                
                $.ajax({
                    type: "post",
                    url: "https://share.jaadee.net/h5/Active/userBindPhone",
                    data: {userToken:RNJsBriageObject.userInfo.userToken, phone:tel, code:code},
                    dataType: "json",
                    success: function(data) {
                    	data=JSON.parse(data)
                        if(data.status==0){
                            layer.closeAll();
                           
                        }else{
                            html = '';
                            html += '<div class="msgbox">';
                            html += '<div class="text">';
                            html += '<p><b>'+JSON.stringify(data)+'</b></p>';
                            html += '</div>';
                            html += '<div class="btn">';
                            html += '<a onclick="closelogin();">关闭</a>';
                            html += '</div>';
                            html += '</div>';
                            layer.open({
                                content: html,
                                style: "background:none; width:100%"
                            });
                        }
                    }
                });
            }
            //发送验证码
            var nums = 60;
            var clock = null;
            var cansend = true;
            function sendCode(obj) {
                //手机号码验证
                if($("#phone").val() == "") {
                    $("#phone").focus().val("手机号不能为空！");
                } else if(!$("#phone").val().match(/^((1[0-9]{1})+\d{9})$/)) {
                    $("#phone").focus().val("手机号码格式不正确");
                } else {
                    if(cansend==true){
                        cansend=false;
                    }
                    else {
                        return false;
                    }
                    clock = setInterval(doLoop, 1000); //一秒执行一次
                    //请求验证码发送接口
                    $.ajax({
                        type: "post",
                        url: "https://share.jaadee.net/H5/recommend/sendMsg",
                        data: {
                            phone: $("#phone").val()
                        },
                        dataType: "json",
                        success: function(data) {
                            if(data.status!= 0) {
                                //alert(55);
                                //layer.msg("1111");
                                 alert(data['info']['msg']);
                            }
                        }
                    });
                }
            }
            //验证码倒计时
            function doLoop() {
                if(clock == null){ return false;}
                nums--;
                if(nums > 0) {
                    $('.get-code').text(nums + '秒');
                } else {
                    clearInterval(clock); //清除js定时器
                    clock=null;
                    cansend = true;
                    $('.get-code').text('获取验证码');
                    nums = 60; //重置时间
                }
            }
            

			function closeLayer() {
				layer.closeAll();
			}

            //显示登录弹窗
            function showlogin() {
                html = '';
                html += '<div class="msgbox">';
                html += '<div class="text">';
                html += '<p><b>您还未登陆</b></p>';
                html += '<p>是否马上登陆</p>';
                html += '</div>';
                html += '<div class="btn">';
                html += '<a onclick="login();">确定</a>';
                html += '<a onclick="closelogin();">取消</a>';
                html += '</div>';
                html += '</div>';
                layer.open({
                    content: html,
                    style: "background:none; width:100%"
                });
            }
            //关闭登录界面
            function closelogin() {
                layer.closeAll();
                
            }
           //登录
            function login() {
            	
            	ds=window.setInterval(function(){
            		
            		 if(RNJsBriageObject.userInfo.userId <= 0) {
            		 	
            		 }else{
            		 	window.clearInterval(ds)
            		 	checkMobile()
            		 }
            		
            		
			     	
			     },1000)
                AppJump.goLogin()
                
            }

			function ck(a){
				$.ajax({
                        type: "post",
                        url: "https://share.jaadee.net/H5/recommend/checkUserGetRecommend?token="+RNJsBriageObject.userInfo.userToken,
                        data: {
                            code: a
                        },
                        dataType: "json",
                        success: function(data) {
                        	data=JSON.parse(data)
                            if(data.status == 0) {
                                //alert(55);
                                //layer.msg("1111");
                                 //alert(data['info']['msg']);
                                 $(".jz").attr("src","img/coupen.png")
                            }else{
                                 $(".jz").attr("src","img/coupenno.png")
                            }
                        }
                        
                    });
			}
			//领取接口判断是否有登入
			$(".lq").click(function(){
				if(RNJsBriageObject.userInfo.userId<=0) {
                    showlogin();
                }
                else{
                    //var visionstr = appUser.vision;
                    
                   lq=true;
                   //检测是否绑定手机号码
                   checkMobile()
                }
			})
			

		</script>
	</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
